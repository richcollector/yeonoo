<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.noo.wms.main.mapper.MainSQLMapper">

	<!-- 관리자 로그인 -->
	<select id="selectByAdminEmailAndPw" resultType="com.noo.wms.vo.AdminVo">
		select * from Admin
		where admin_email = #{admin_email}
		and admin_password = #{admin_password}
	</select>

	<!-- 사원 회원가입 -->
	<insert id="insertEmployee">
		insert into Employee(
			department_code,
			employee_rank_code,
			authority_code,
			employee_email,
			employee_password,
			employee_name,
			employee_state,
			employee_join_date,
			employee_leave_date
		) values (
			#{department_code},
			'rank_code',
			'1',
			#{employee_email},
			#{employee_password},
			#{employee_name},
			'T',
			SYSDATE(),
			null
		)
		<selectKey keyColumn="employee_code" keyProperty="employee_code" resultType="com.noo.wms.vo.EmployeeVo" order="AFTER">
		      select employee_code from Employee 
    		  ORDER BY employee_code DESC LIMIT 1
		</selectKey>
	</insert>
		
	<!-- 사원 로그인 -->
	<select id="selectByEmployeeEmailAndPw" resultType="com.noo.wms.vo.EmployeeVo">
		<!-- select * from Employee
		where employee_email = #{employee_email}
		and employee_password = #{employee_password} -->
		
		select *
		from Employee e ,MailAuth m
		where e.employee_code = m.employee_code
		and e.employee_email = #{employee_email}
		and e.employee_password = #{employee_password}
		and m.auth_complete = 'Y'
		
	</select>

	<!-- 회원가입시 회사 코드 불러오기 -->	
	<select id="selectCompanyCode" resultType="com.noo.wms.vo.CompanyVo">
		select company_code from Company
		order by company_code asc
	</select>
	
	<!-- 회원가입시 회사코드로 부서코드 불러오기 -->
	<select id="selectDepCodeByCompanyCode" resultType="com.noo.wms.vo.DepartmentVo">	
		select * from Department
		where company_code = #{company_code}
	</select>
	
	<!-- 회원가입시 이메일 중복확인 -->
	<select id="selectEmployeeEmailByEmail" resultType="com.noo.wms.vo.EmployeeVo">
		select * from Employee
		where employee_email = #{employee_email}
	</select>
	
	<!-- 회원가입 메일 인증 -->
	<insert id="insertMailAuth">
		INSERT INTO MailAuth(
			employee_code,
			auth_key,
			auth_complete,
			auth_date
		) VALUES (
			#{employee_code}, 
			#{auth_key},
			'N',
			null
		)	
	</insert>
	
	<update id="updateCompleteY">
		UPDATE MailAuth 
		SET auth_complete = 'Y' , auth_date = SYSDATE() 
		WHERE auth_key = #{auth_key}
	</update>
	
	<!-- 공지사항 작성 -->
	<insert id="insertNotice">
		insert into Notice(
			admin_code,
			notice_title,
			notice_content,
			notice_write_date
		) values (
			#{admin_code},
			#{notice_title},
			#{notice_content},
			SYSDATE()
		)
	</insert>
	
	<!-- 공지사항 데이터 불러오기 -->
	<select id="selectNotice" resultType="com.noo.wms.vo.NoticeVo">
		select * from Notice
		order by notice_code desc
	</select>
	
	<!-- 공지사항 상세보기 -->
	<select id="selectNoticeByNoticeCode" resultType="com.noo.wms.vo.NoticeVo">
		select * from Notice
		where notice_code = #{notice_code}
	</select>
	
	<!-- 공지사항 삭제 -->
	<delete id="deleteNoticeByNoticeCode">
		delete from Notice
		where notice_code = #{notice_code}
	</delete>
	
	
</mapper>